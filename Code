def read(textfile):
    flag = True
    while flag:
        try:
            # change to read in sequence from file
            textseq = open(textfile, 'r').readlines()
            originalseq = ""
            for line in textseq:
                originalseq = textseq
            originalseq = ''.join(originalseq)
            # Raises all the nucleotides to upper case to get rid of user input case error
            originalseq = originalseq.upper()
            for c in originalseq:
                if c not in "5â€™ACGT3' ":
                    raise ValueError
                else:
                    flag = False
        except ValueError:
            print("There was an error in the protein sequence, please try again. \n")

    for char in originalseq:
        if not char.isalpha():
            originalseq = originalseq.replace(char, '')
    print("Original sequence: "+originalseq)
    return(originalseq)

def complement(originalseq):
    # Reverses the sequence
    backward = originalseq[::-1]
    complementaryseq = []
    pair = {"A": "T", "C": "G", "T": "A", "G": "C"}
    for i in range(len(backward)):
        if backward[i] in pair.keys():
            complementaryseq.append(pair[backward[i]])

    complementaryseq = ''.join(complementaryseq)
    print("Complementary sequence: " + complementaryseq)
    return complementaryseq

def orf(gene):
    frames = []
    # Reading frames for the original sequence and reverse complement
    # We assume that the length of the sequence and complement should be the same
    # 3 possible frames for sequence and 3 possible for the reverse complement
    for x in range(3):
        for i in gene and in range(x, len(gene), 3):
            if (i + 2) < len(gene):
                frames = gene[i:i + 3]

    # Returns the longest gene sequence
    orfList = list()
    for frame in frames:
        gene = []
        orf = False
        for codon in frame:
            if codon == "ATG" and orf == False:
                gene.append(codon)
                orf = True
            elif codon == ("TAA", "TGA", "TAG") and orf == True:
                    gene.append(codon)
                    orf = False
            else:
                if orf == True:
                    gene.append(codon)
    return gene

def transcribe(gene):
    # Transcribes gene into mRNA
    gene = str(gene)
    gene = gene.upper()
    listHolder = list(gene)
    for i in range(len(listHolder)):
        if listHolder[i] == 'T':
            listHolder[i] = 'U'
    mrnaSequence = "".join(listHolder)
    return mrnaSequence

def translate(mrnaSequence):
    # Translate mRNA into AA sequence
    aaSequence = []
    codonList = [mrnaSequence[i:i+3] for i in range(0,len(mrnaSequence),3)]
    for i in codonList:
        if i == "AUG":
            aaSequence.append("M")
        elif i == "UUU" or i == "UUC":
            aaSequence.append("F")
        elif i == "UUA" or i == "UUG" or i == "CUU" or i == "CUC" or i == "CUA" or i == "CUG":
            aaSequence.append("L")
        elif i == "GUU" or i == "GUC" or i == "GUA" or i == "GUG":
            aaSequence.append("V")
        elif i == "UCU" or i == "UCC" or i == "UCA" or i == "UCG" or i == "AGU" or i == "AGC":
            aaSequence.append("S")
        elif i == "CCU" or i == "CCC" or i == "CCA" or i == "CCG":
            aaSequence.append("P")
        elif i == "ACU" or i == "ACC" or i == "ACA" or i == "ACG":
            aaSequence.append("T")
        elif i == "GCU" or i == "GCC" or i == "GCA" or i == "GCG":
            aaSequence.append("A")
        elif i == "UAU" or i == "UAC":
            aaSequence.append("Y")
        elif i == "CAU" or i == "CAC":
            aaSequence.append("H")
        elif i == "CAA" or i == "CAG":
            aaSequence.append("Q")
        elif i == "AAU" or i == "AAC":
            aaSequence.append("N")
        elif i == "AAA" or i == "AAG":
            aaSequence.append("K")
        elif i == "GAU" or i == "GAC":
            aaSequence.append("D")
        elif i == "GAA" or i == "GAG":
            aaSequence.append("E")
        elif i == "UGU" or i == "UGC":
            aaSequence.append("C")
        elif i == "UGG":
            aaSequence.append("W")
        elif i == "CGU" or i == "CGC" or i == "CGA" or i == "CGG" or i == "AGA" or i == "AGG":
            aaSequence.append("R")
        elif i == "GGU" or i == "GGC" or i == "GGA" or i == "GGG":
            aaSequence.append("G")
        elif i == "AUU" or i == "AUC" or i == "AUA":
            aaSequence.append("I")
        else:
            break
    print("Amino acid sequence translated from mRNA: " + "".join(aaSequence))
    return("".join(aaSequence))

def main():
    textfile = input("Enter text file name: ")
    seq = read(textfile)
    comp = complement(seq)
    gene1 = orf(seq)
    gene2 = orf(comp)
    if len(gene1) > len(gene2):
        gene = gene1
    else:
        gene = gene2
    print("Longest ORF gene sequence: "+gene)
    print("mRNA transcribed from gene: " + transcribe(orf(seq,comp)))
    translate(transcribe(orf(seq,comp)))

if __name__ == "__main__":
    main()
